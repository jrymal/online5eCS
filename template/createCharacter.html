<title>Create a new character</title>
<description>Build your character.</description>
<template>
   <form class="wizardScreen">
       <label for="player" name="player">Role Player</label>
       <input type="text" id="createCharacter.player.name" name="player" required/>

       <label for="phone" name="phone">Phone Number</label>
       <input type="tel" id="createCharacter.player.phone" name="phone" autocomplete="tel"/>

       <label for="email" name="email">Email</label>
       <input type="email" id="createCharacter.player.email" name="email" autocomplete="email"/> 
   </form>
   
   <form class="wizardScreen">
       <label for="name" name="name">Character Name</label>
       <input type="text" id="createCharacter.race.name" name="name" required/>

       <label for="race" name="race">Race</label>
       <select id="createCharacter.race.race" onchange="updateRace(event)" name="race"></select>
   </form>

   <form class="wizardScreen">
       <label for="class" name="class">Class</label>
       <select id="createCharacter.class.class" name="class" onchange="updateClass(event)"></select>

       <label for="level" name="level">Level</label>
       <input type="number" id="createCharacter.class.level" pattern="[0-9]*" class="short" name="level" min="1" max="40" required value="1"/>
        
   </form>
   
   <form class="wizardScreen">
       <label for="createCharacter.strength" name="createCharacter.strength">Strength</label>
       <input type="number"  pattern="[0-9]*" name="strength" id="createCharacter.strength" class="short"  min="3" max="20" />
       <label for="createCharacter.dexterity" name="createCharacter.dexterity">Dexterity</label>
       <input type="number"  pattern="[0-9]*" name="dexterity" id="createCharacter.dexterity" class="short"  min="3" max="20" />
       <label for="createCharacter.constitution" name="createCharacter.constitution">Constitution</label>
       <input type="number"  pattern="[0-9]*" name="constitution" id="createCharacter.constitution" class="short"  min="3" max="20" />
       <label for="createCharacter.intelligence" name="createCharacter.intelligence">Intelligence</label>
       <input type="number"  pattern="[0-9]*" name="intelligence" id="createCharacter.intelligence" class="short"  min="3" max="20" />
       <label for="createCharacter.wisdom" name="createCharacter.wisdom">wisdom</label>
       <input type="number"  pattern="[0-9]*" name="wisdom" id="createCharacter.wisdom" class="short"  min="3" max="20" />
       <label for="createCharacter.charisma" name="createCharacter.charisma">charisma</label>
       <input type="number"  pattern="[0-9]*" name="charisma" id="createCharacter.charisma" class="short"  min="3" max="20" />
   </form>
   
   <form class="wizardScreen">
       <label for="backstory" name="backstory">Backstory</label>
       <select id="createCharacter.backstory.backstory.type" name="backstory.type" onchange="updateBackstory()"></select>
       <textarea id="createCharacter.backstory.backstory" name="backstory" spellcheck="true"></textarea> 
   </form>

   <form class="wizardScreen">
       <label for="age" name="age">Age</label>
       <input type="number" pattern="[0-9]*" id="createCharacter.details.age" class="short" name="age" min="1" max="100" value="18"/>

       <label for="height" name="height">Height</label>
       <input type="text" id="createCharacter.details.height" name="height"/>

       <label for="weight" name="weight">Weight</label>
       <input type="text" id="createCharacter.details.weight" name="weight"/>

       <label for="eyecolor" name="eyecolor">Eye Color</label>
       <input type="color" id="createCharacter.details.eyecolor" name="eyecolor"/>

       <label for="skin" name="skin">Skin Color</label>
       <input type="color" id="createCharacter.details.skin" name="skin"/>

       <label for="hair" name="hair">Hair Color</label>
       <input type="color" id="createCharacter.details.hair" name="hair"/>

       <label for="appearance" name="appearance">Appearance</label>
       <textarea id="createCharacter.details.appearance" spellcheck="true" name="appearance"></textarea> 
   </form>

   <form class="wizardScreen">
       <fieldset>
           <legend class="skill_title">Skills</legend>
           <div id="createCharacter.skills_container" class="skills_grid"></div>
       </fieldset>
   </form>
   
   <form class="wizardScreen">
       <label for="languages" name="languages">Languages</label>
       <textarea id="createCharacter.languages" name="languages" spellcheck="true"></textarea>
       <textarea id="createCharacter.backstory.languages" name="backstory.languages" spellcheck="true"></textarea>

       <label for="proficiencies" name="proficiencies">Proficiencies</label>
       <div id="createCharacter.class.proficiencies"></div>
       <textarea id="createCharacter.proficiencies" name="proficiencies" spellcheck="true"></textarea>
       
       <label for="features" name="features">Features & Traits</label>
       <textarea id="createCharacter.features" name="features" spellcheck="true"></textarea>
       
       <label for="personalitytraits" name="personalitytraits">Personality Traits</label>
       <textarea id="createCharacter.personalitytraits" name="personalitytraits" spellcheck="true"></textarea>
       
       <label for="ideals" name="ideals">Ideals</label>
       <textarea id="createCharacter.ideals" name="ideals" spellcheck="true"></textarea>
       
       <label for="bonds" name="bonds">Bonds</label>
       <textarea id="createCharacter.bonds" name="bonds" spellcheck="true"></textarea>
       
       <label for="flaws" name="flaws">Flaws</label>
       <textarea id="createCharacter.flaws" name="flaws" spellcheck="true"></textarea>
       
       <label for="allies" name="allies">Allies</label>
       <textarea id="createCharacter.allies" name="allies" spellcheck="true"></textarea>
   </form>
   

   <form class="wizardScreen">
       <label for="weapons" name="weapons">Weapons</label>
       <textarea id="createCharacter.weapons" name="weapons" spellcheck="true"></textarea>
       
       <label for="equipment" name="equipment">Equipment</label>
       <textarea id="createCharacter.equipment" name="equipment" spellcheck="true"></textarea>
       <textarea id="createCharacter.backstory.equipment" name="backstory.equipment" spellcheck="true" aria-label="Backstory Equipment"></textarea>
       
       <label for="treasure" name="treasure">Treasure</label>
       <textarea id="createCharacter.treasure" name="treasure" spellcheck="true"></textarea>
   </form>

   <div class="buttonbar">
       <button type="button" onclick="cancelModal()">Cancel</button>
       <button type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
       <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
    </div>

    <!-- Circles which indicates the steps of the form: -->
    <div class="step_wrapper">
        <span class="step"></span>
        <span class="step"></span>
        <span class="step"></span>
        <span class="step"></span>
        <span class="step"></span>
        <span class="step"></span>
        <span class="step"></span>
        <span class="step"></span>
        <span class="step"></span>
    </div>

    <script type="text/javascript" >
        var currentTab = 0; // Current tab is set to be the first tab (0)
        showTab(currentTab); // Display the current tab

        function showTab(n) {
          // This function will display the specified tab of the form ...
          var x = document.getElementsByClassName("wizardScreen");
          x[n].style.display = "block";
          // ... and fix the Previous/Next buttons:
          if (n == 0) {
            document.getElementById("prevBtn").style.display = "none";
          } else {
            document.getElementById("prevBtn").style.display = "inline";
          }
          if (n == (x.length - 1)) {
            document.getElementById("nextBtn").innerHTML = "Submit";
          } else {
            document.getElementById("nextBtn").innerHTML = "Next";
          }
          // ... and run a function that displays the correct step indicator:
          fixStepIndicator(n)
        }

        function nextPrev(n) {
          // This function will figure out which tab to display
          var x = document.getElementsByClassName("wizardScreen");
          // Exit the function if any field in the current tab is invalid:
          if (n == 1 && !validateForm()) return false;
          // Hide the current tab:
          x[currentTab].style.display = "none";
          // Increase or decrease the current tab by 1:
          currentTab = currentTab + n;
          // if you have reached the end of the form... :
          if (currentTab >= x.length) {
            //...the form gets submitted:
            document.getElementById("regForm").submit();
            return false;
          }
          // Otherwise, display the correct tab:
          showTab(currentTab);
        }

        function validateForm() {
            var x = document.getElementsByClassName("wizardScreen");
            var currentForm = x[currentTab];
            var valid = currentForm.checkValidity(); 
            
            // could use the validity object to add top level error messages....

            // If the valid status is true, mark the step as finished and valid:
            if (valid) {
                document.getElementsByClassName("step")[currentTab].className += " finish";
            }
            return valid; // return the valid status
        }

        function fixStepIndicator(n) {
          // This function removes the "active" class of all steps...
          var i, x = document.getElementsByClassName("step");
          for (i = 0; i < x.length; i++) {
            x[i].className = x[i].className.replace(" active", "");
          }
          //... and adds the "active" class to the current step:
          x[n].className += " active";
        }

        function initModal() {
            // set up selects
            populateSelect($('class', 'createCharacter.class'), CLASSES);
            populateSelect($('race', 'createCharacter.race'), RACES);
            populateSelect($('backstory.type', 'createCharacter.backstory'), BACKSTORIES);
            populateCheckboxes($('skills_container', 'createCharacter'), SKILLS);
         
        }

        function populateSelect(selectEle, sourceObj) {
            var fragment = document.createDocumentFragment();
            var sourceArray = Object.keys(sourceObj).sort();

            for (var i = 0; i < sourceArray.length; i++  ) {
                var value = sourceArray[i];
                var obj = sourceObj[value];

                // create base class
                var opt = document.createElement('option');
                opt.innerHTML = obj.name ? obj.name : value;
                opt.value = value;

                fragment.appendChild(opt);
            }

            selectEle.appendChild(fragment);
        }

        function populateCheckboxes(divEle, sourceObj) {
            var fragment = document.createDocumentFragment();
            var sourceArray = Object.keys(sourceObj).sort();

            for (var i = 0; i < sourceArray.length; i++  ) {
                var value = sourceArray[i];
                var obj = sourceObj[value];

                var lbl = document.createElement('label');
                lbl.innerHTML = obj.name;
                lbl.htmlFor="skills."+value;
                lbl.className="skills_item";

                var opt = document.createElement('input');
                opt.value = value;
                opt.type = "checkbox";
                opt.name = "skills";
                opt.id ="skills."+value;
                opt.setAttribute("onChange", "updateRace()");

                fragment.appendChild(lbl);
                fragment.appendChild(opt);
            }

            divEle.appendChild(fragment);
        }
    </script>
</template>
